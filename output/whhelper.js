// ==UserScript==
// @name         Wykopowe trole - DEV
// @version      0.2
// @updateURL    http://plw.usermd.net/whhelper.js
// @downloadURL  http://plw.usermd.net/whhelper.js
// @description  Zestaw narzędzi pomocnych na wykopie.
// @author       PLW
// @match        https://www.wykop.pl/*
// @grant        none
// ==/UserScript==
!function(){"use strict";const e=(e="troll")=>`<span class="badge badge--${e.toLowerCase()}">${e.toLowerCase().capitalize()}</span>`,t=()=>{const t=e=>JSON.parse(e),o=e=>JSON.stringify(e);let n,a=[];const r=e=>!!a.includes(e),l=(e,t)=>{r(e)||((e=>{a.push(e),localStorage.setItem("uniqueNicks",o(a))})(e),((e,t)=>{n.push({nick:e,link:t}),localStorage.setItem("trolls",o(n))})(e,t))},i=()=>document.querySelectorAll("li div.author"),s=e=>e.querySelector(".showProfileSummary > b").innerText,c=e=>!e.querySelector(".badge"),u=()=>{n=localStorage.getItem("trolls")?t(localStorage.getItem("trolls")):[],a=localStorage.getItem("uniqueNicks")?t(localStorage.getItem("uniqueNicks")):[]},p=(t="Troll")=>{try{i().forEach(o=>{const n=s(o);r(n)&&c(o)?o.insertAdjacentHTML("afterbegin",e(t)):(e=>!!e.querySelector(".buttonWH"))(o)||o.insertAdjacentHTML("beforeend",'<span class="buttonWH">Troll</span>')})}catch(e){}},d=t=>{u();const o=s(t.target.closest(".author")),n=t.target.closest(".author").querySelector("a + a").href;t.target.classList.add("buttonWH--clicked"),t.target.innerText="✔",setTimeout(()=>{t.target.remove()},700),l(o,n),(()=>{try{i().forEach(t=>{const o=s(t);r(o)&&c(t)&&t.insertAdjacentHTML("afterbegin",e()),r(o)&&c(t)&&t.querySelector("buttonWH")&&!t.querySelector("buttonWH--clicked")&&t.querySelector(".buttonWH").remove()})}catch(e){}})()},m=e=>{const t=(e=>{u();for(let t of n)if(t.nick===e)return{link:t.link,nick:t.nick}})(s(e));((e,t)=>{tippy(e,{content:t,allowHTML:!0,interactive:!0,placement:"bottom-start",followCursor:"initial"})})(e,((e,t)=>`\n<div class="wh__modal">\n  <h1 class="wh__modal-title">Info</h1>\n  <p class="wh__modal-text">Powód oznaczenia: \n    <a href="${e}" target="_blank" data-whuser-remove="${t}">${t} link</a>\n  </p>\n  <span class="wh__modal-button">Usuń oznaczenie</span>\n</div>\n`)(t.link,t.nick))};(e=>{const t=`<style> ${e} </style>`;document.body.insertAdjacentHTML("afterbegin",t)})("\n.buttonWH {\n  display: inline-block;\n  padding: .2rem .2rem;\n  border: 1px solid #9999996e;\n  cursor: pointer;\n  margin-left: .5rem;\n  color: #808080ba;\n  border-radius: .3rem;\n  font-size: .7rem;\n  line-height: .7rem;\n  transition: .3s all;\n}\n.buttonWH:hover {\n  border-color: green;\n}\n.buttonWH--clicked {\n  border-color: green;\n  opacity: 0;\n}\n.badge--troll {\n  color: red;\n  font-weight: bold;\n  margin-right: .3rem;\n  border: 1px solid currentColor;\n  padding: .1rem .2rem;\n}"),u(),p(),document.getElementById("itemsStream").addEventListener("click",e=>{const t=e.target;if(t.classList.contains("buttonWH")&&d(e),t.classList.contains("affect")&&t.closest(".more")&&setTimeout(()=>{u(),p()},500),t.classList.contains("badge")){let t=(e=>e.target.closest(".author"))(e);m(t)}})},o=location.href;String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},["https://cdn.jsdelivr.net/npm/sweetalert2@9","https://unpkg.com/@popperjs/core@2","https://unpkg.com/tippy.js@6"].forEach(e=>(e=>{const t=document.createElement("script");t.type="text/javascript",t.src=e,t.async=!1,t.defer=!1,document.head.insertBefore(t,document.head.childNodes[0])})(e)),setTimeout(()=>{localStorage.getItem("WHupdate")&&localStorage.getItem("WHupdate")<.123?(Swal.fire({title:"WykopHelper zaktualizowany!",html:'Dodatek WykopHelper został właśnie zaktualizowany. Wprowadzone zmiany to: <br><ul style="margin-top:1rem; list-style-type:square"><li style="text-align:left;margin-left:2rem">nowy sposób komunikowania o aktualizacjach :)</li></ul>',icon:"info",confirmButtonText:"Okej!"}),localStorage.setItem("WHupdate",.123)):localStorage.getItem("WHupdate")||(Swal.fire({title:"WykopHelper zainstalowany!",html:'Miłego użytkowania dodatku! Jeśli masz jakiekolwiek problemy, pytania lub sugestie, zgłoś je <a href="https://github.com/PLWpl/wykopoweTrole/issues" target="_blank">tutaj.</a>',icon:"success",confirmButtonText:"Super!"}),localStorage.setItem("WHupdate",.123)),(o.indexOf("wykop.pl/link/")>-1||o.indexOf("wykop.pl/mikroblog/")>-1||o.indexOf("wykop.pl/wpis/")>-1||o.indexOf("wykop.pl/moj/")>-1||o.indexOf("wykop.pl/tag/wpisy")>-1)&&t()},250)}();
